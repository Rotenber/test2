jQuery(function(e){e.datepicker.regional.nl={closeText:"Sluiten",prevText:"Vorige",nextText:"Volgende",currentText:"Vandaag",monthNames:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],monthNamesShort:["jan","feb","maa","apr","mei","jun","jul","aug","sep","okt","nov","dec"],dayNames:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],dayNamesShort:["zon","maa","din","woe","don","vri","zat"],dayNamesMin:["zo","ma","di","wo","do","vr","za"],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.regional.en={closeText:"Done",prevText:"Previous",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.regional.fr={closeText:"Fermer",prevText:"Précédent",nextText:"Suivant",currentText:"Aujourd'hui",monthNames:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],monthNamesShort:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],dayNames:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dayNamesShort:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],dayNamesMin:["D","L","M","M","J","V","S"],weekHeader:"Sem.",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.regional.it={closeText:"Chiudi",prevText:"&#x3C;Prec",nextText:"Succ&#x3E;",currentText:"Oggi",monthNames:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthNamesShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],dayNames:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"],dayNamesShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],dayNamesMin:["Do","Lu","Ma","Me","Gi","Ve","Sa"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.regional.es={closeText:"Cerrar",prevText:"&#x3C;Ant",nextText:"Sig&#x3E;",currentText:"Hoy",monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],dayNamesShort:["dom","lun","mar","mié","jue","vie","sáb"],dayNamesMin:["D","L","M","X","J","V","S"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.regional.de={closeText:"Schließen",prevText:"&#x3C;Zurück",nextText:"Vor&#x3E;",currentText:"Heute",monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],weekHeader:"KW",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.regional.pt={closeText:"Fechar",prevText:"Anterior",nextText:"Seguinte",currentText:"Hoje",monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],dayNamesMin:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],weekHeader:"Sem",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.regional.zh={closeText:"關閉",prevText:"&#x3C;上個月",nextText:"下個月&#x3E;",currentText:"今天",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["週日","週一","週二","週三","週四","週五","週六"],dayNamesMin:["日","一","二","三","四","五","六"],weekHeader:"週",dateFormat:"yy/mm/dd",firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"年"},e.datepicker.regional.ru={closeText:"Закрыть",prevText:"&#x3C;Пред",nextText:"След&#x3E;",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Нед",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.regional.ja={closeText:"閉じる",prevText:"&#x3C;前",nextText:"次&#x3E;",currentText:"今日",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayNames:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"],dayNamesShort:["日","月","火","水","木","金","土"],dayNamesMin:["日","月","火","水","木","金","土"],weekHeader:"週",dateFormat:"yy/mm/dd",firstDay:0,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"年"},e.datepicker.regional.ko={closeText:"닫기",prevText:"이전달",nextText:"다음달",currentText:"오늘",monthNames:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],monthNamesShort:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayNames:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],dayNamesShort:["일","월","화","수","목","금","토"],dayNamesMin:["일","월","화","수","목","금","토"],weekHeader:"주",dateFormat:"yy. m. d.",firstDay:0,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"년"}});

/* number_format */
function number_format(a,b,c,d){a=(a+"").replace(/[^0-9+-Ee.]/g,"");var e=!isFinite(+a)?0:+a,f=!isFinite(+b)?0:Math.abs(b),g=typeof d==="undefined"?",":d,h=typeof c==="undefined"?".":c,i="",j=function(a,b){var c=Math.pow(10,b);return""+Math.round(a*c)/c};i=(f?j(e,f):""+Math.round(e)).split(".");if(i[0].length>3){i[0]=i[0].replace(/B(?=(?:d{3})+(?!d))/g,g)}if((i[1]||"").length<f){i[1]=i[1]||"";i[1]+=(new Array(f-i[1].length+1)).join("0")}return i.join(h)}

$(function()
{
	/*
	* variable
	*/
	var effectSpeed = 'slow';
	var ajaxRequest;

	$('.ticket-info').find('.ticket-info__list').find('li:nth-child(4)').hide();

	/*
	* date functions
	*/
	function getDisabledDates(date)
	{
		var month = ("0" + (date.getMonth() + 1)).slice(-2);

		var d = date.getFullYear()  + '-' + month + '-' + ("0" + date.getDate()).slice(-2);

		if(jQuery.inArray(date.getDay(), disabledDays) >= 0 || jQuery.inArray(d, disabledDates) >= 0)
		{
			if(jQuery.inArray(d, openDays) < 0)
			{
				return [false, 'disabled'];
			}
			else if(jQuery.inArray(d, soldoutDays) >= 0)
			{
				return [false, 'soldout'];
			}
		}
		else if(jQuery.inArray(d, soldoutDays) >= 0)
		{
			return [false, 'soldout'];
		}
		else if(jQuery.inArray(d, quiethourDays) >= 0)
		{
			return [true, 'quiethour'];
		}

		return [true];
	}

	$.datepicker.setDefaults($.datepicker.regional[language]);

	$('#datepicker').datepicker(
	{
		altField: '#ticketDate',
		altFormat: 'yy-mm-dd',
		dateFormat: 'yy-mm-dd',
		minDate: ticketDateMin,
		maxDate: ticketDateMax,
		beforeShowDay: getDisabledDates,
		firstDay: 1,
		numberOfMonths: 2,
		onSelect: function(dateText, inst)
		{
			/* ticketDate variable */
			var ticketDate = $(this).val();

			/* quiethour days */
			if(jQuery.inArray(ticketDate, quiethourDays) >= 0)
			{
				$('.item-quiethour').show();
			}
			else
			{
				$('.item-quiethour').hide();
			}

			/* summer text */
			$('#zomer-vrijdag').hide();
			$('#zomer-zaterdag').hide();

			/* load timeslots */
			loadTimeslots(ticketDate);
		}
	});

	function datepickerDisplay()
	{
		var winWidth = $(window).width();

		$('#datepicker').datepicker('option', 'numberOfMonths', 2);

		if (winWidth < 768)
		{
			$('#datepicker').datepicker('option', 'numberOfMonths', 1);
		}
	}

	datepickerDisplay();

	$(window).resize(function()
	{
		datepickerDisplay();
	});

	/* remove default datepicker date */
	$('.ui-datepicker-current-day').removeClass('ui-datepicker-current-day');

/*
	$('#ticketDate').change(function()
	{
		loadTimeslots($(this).val());

		return false;
	});
*/

	if($('.form-persons').length > 0 && $('.form-persons').find('.row-ticketType:hidden').length == 0)
	{
		$('.ticket-info__more-options').hide();
	}

	var firstLoad = false;

	/* loadTimeslots */
	function loadTimeslots(ticketDate)
	{
		/* loaded */
		var loaded = false;

		/* hide timeslots */
		$('.time-selection, .time-selection .timeslots, .timeslots-waanzin').hide();

		/* deactive button */
		$('div.ticket-button, div.ticket-button-submit').removeClass('active');

		/* abort previous ajax request */
		if(ajaxRequest)
		{
			ajaxRequest.abort();
		}

		var vgjStart = new Date('2018-03-23').getTime();
		var vgjEnd = new Date('2018-06-24').getTime();
		var ticketDateCheck = new Date(ticketDate).getTime();

		if(ticketDateCheck >= vgjStart && ticketDateCheck <= vgjEnd)
		{
			$('header.header').addClass('van-gogh-in-japan');
		}
		else if($('header.header').hasClass('van-gogh-in-japan'))
		{
			$('header.header').removeClass('van-gogh-in-japan');
		}

		if(typeof onDatepickerOption != 'undefined')
		{
			onDatepickerOption(ticketDate);
		}

		var numberOfTickets = $('#people-select').val();

		/* load timeslots */
		ajaxRequest = $.ajax({
			url: '/globalticket/template/vangoghmuseum/script/getTimeslot.php',
			cache: false,
			dataType: 'json',
			data: { ticketDate: ticketDate , language : $('html').attr('lang'), numberOfTickets : numberOfTickets },
			beforeSend: function() { showLoading(); },
			method: 'POST',
			success: function(output)
			{
				/* clear loading */
				loaded = true;

				/* clear table-time */
				$('.timeslots .table-time').html('');
				$('.timeslots .table-time-overflow').html('').hide();
				$('.timeslots .overflow-container').hide();

				/* success */
				if(output.success)
				{
					if(output.timeslots)
					{
						$.each(output.timeslots, function(index, value)
						{
							$('.timeslots .table-time').append('<a href="#" class="notranslate time-row' + (value.available === true ? ' time-free' : ' time-ua') + (value.available === true && value.busy === true ? ' time-busy' : '') + (value.quiethour && value.quiethour === true ? ' time-quiethour' : '') + '">' + index + (value.quiethour === true ? '<span>' + value.quiethourText + '</span>' : '') + '</a>');
						});
					}

					if(output.overflowTimeslots != undefined)
					{
						$.each(output.overflowTimeslots, function(index, value)
						{
							$('.timeslots .table-time-overflow').append('<a href="#" class="notranslate time-row' + (value.available === true ? ' time-free' : ' time-ua') + (value.available === true && value.busy === true ? ' time-busy' : '') + (value.quiethour && value.quiethour === true ? ' time-quiethour' : '') + '">' + index + '</a>');
						});
						$('.timeslots .table-time-overflow, .timeslots .overflow-container').show()
					}
				}
				else
				{

				}

				/* hide loading */
				$('.time-selection .loading').hide();

				/* show time-step */
				$('.time-selection, .time-selection .timeslots').fadeIn(effectSpeed);

				if(firstLoad === false)
				{
					/* scroll to time-step */
					$.scrollTo('.timeslots', 500);
				}

				firstLoad = false;

				/* waanzin */
				if(ticketDate == '2017-05-13' && $('.timeslots-waanzin'))
				{
					$('.timeslots-waanzin').show();
				}

				/* ajaxRequest */
				ajaxRequest = false;
			}
		});
	}

	if(typeof(setDate) != 'undefined' && setDate != '')
	{
		loadTimeslots(setDate);
	}

	/* show loading */
	function showLoading()
	{
		$('.time-selection, .time-selection .loading').show(effectSpeed);

		setTimeout(function(){
			$('.time-selection .loading').hide();
		},2500);
	}

	/*
	* time functions
	*/
	$('.table-time').on('click', 'a', function()
	{
		if($(this).hasClass('time-free'))
		{
			/* ticketTime */
			var ticketTime = $(this).html();
			ticketTime = ticketTime.substr(0, 5);
			$('input#ticketTime').val(ticketTime);
			$('input#overflowTime').val('');

			/* remove all selected class */
			$('.table-time a').removeClass('time-active');

			/* set selected */
			$(this).addClass('time-active');

			if(typeof onTimeslotOption != 'undefined')
			{
				onTimeslotOption(ticketTime);
			}

			/* activate button */
			$('div.ticket-button, div.ticket-button-submit').addClass('active');
		}

		return false;
	});

	$('.table-time-overflow').on('click', 'a', function()
	{
		if($(this).hasClass('time-free'))
		{
			/* ticketTime */
			var ticketTime = $(this).html();
			$('input#ticketTime').val(ticketTime);
			$('input#overflowTime').val('true');

			/* remove all selected class */
			$('.table-time a').removeClass('time-active');

			/* set selected */
			$(this).addClass('time-active');

			/* activate button */
			$('div.ticket-button, div.ticket-button-submit').addClass('active');
		}

		return false;
	});

	Date.prototype.yyyymmdd = function()
	{
		var yyyy = this.getFullYear().toString();
		var mm = (this.getMonth()+1).toString(); // getMonth() is zero-based
		var dd  = this.getDate().toString();
		return yyyy + '-' + (mm[1]?mm:"0"+mm[0]) + '-' + (dd[1]?dd:"0"+dd[0]); // padding
	};

	function datepickerMobileDate(next)
	{
		var date = new Date(Date.parse($('#ticketDate').val()));

		if(next)
		{
			date.setDate(date.getDate() + 1);
		}
		else
		{
			date.setDate(date.getDate() - 1);
		}

		var tomorrow = date.yyyymmdd();

		$('#ticketDate').val(tomorrow);
	}

	/* mobile datepicker */
	$('.date-group .icon-arrow-left').click(function()
	{
		datepickerMobileDate(false);
		loadTimeslots($('#ticketDate').val());

		return false;
	});

	$('.date-group .icon-arrow-right').click(function()
	{
		datepickerMobileDate(true);
		loadTimeslots($('#ticketDate').val());

		return false;
	});

	/*
	* navigation

	function setNavTicketDate(date)
	{
		if(date == '')
		{
			$('#navDate').html('').hide();
			$('#navDateTime p.hidden-xs').hide();
		}
		else
		{
			$('#navDate').html(date).show();
			$('#navDateTime p.hidden-xs').show();
		}
	}

	function setNavTicketTime(time)
	{
		if(time == '')
		{
			$('#navTime').html('').hide();
		}
		else
		{
			$('#navTime').html(time).show();
		}
	}
	*/



	/*
	* button
	*/
	$('nav.nav-steps').on('click', 'div.ticket-button.active a', function()
	{
		$('form#gt').submit();

		return false;
	});

	$('.ticket-zone .container').on('click', 'div.ticket-button-submit.active a', function()
	{
		$('form#gt').submit();

		return false;
	});

	$('.donation-zone-new .container').on('click', 'div.ticket-button-submit.active a', function()
	{
		$('form#gt').submit();

		return false;
	});

	/*
	* tickets
	*/
	$('select.tickets-selection').on('change', function()
	{
		if($(this).parents('.row-ticketType').find('.descriptionHidden').length > 0)
		{
			if($(this).val() > 0)
			{
				$(this).parents('.row-ticketType').find('.descriptionHidden').show();
			}
			else
			{
				$(this).parents('.row-ticketType').find('.descriptionHidden').hide();
			}
		}
		updatePrices();
	});

	if($('#tickets_begeleider').length > 0)
	{
		updatePrices();
	}

	function updatePrices()
	{
		var id;
		var amount = 0;
		var ticketsAmount = 0;
		var total, price, ticketsTotal = 0.00;
		var multimediaTours = {};
		var iAmsterdam, countAdult, countYouth = 0;
		var companionTickets = 0;
		var companionSave = $('#tickets_begeleider').val();

		/* nav tickets */
		$('#navTickets').html('');
		$('#navTicketsSummary p.hidden-xs').hide();

		if($('#tickets_bgl-vip').attr('data-bglmmt') == 'true')
		{
			$('#row_bgl-vip').attr('data-mmt', 'bglvip');
		}

		if($('#tickets_begeleider').attr('data-begeleidermmt') == 'true')
		{
			$('#row_begeleider').attr('data-mmt', 'begeleider');
		}

		/* handle select */
		$('select.tickets-selection').each(function(index, element)
		{
			/* id */
			id = $(this).attr('id');
			id = id.replace('tickets_', '');

			/* amount */
			amount = $(this).val();
			amount = (amount.length === 0 ? 15 : parseInt(amount));

			if(id == 'iamsterdam' && amount > 0)
			{
				iAmsterdam = amount;
			}

			if(id == 'adult' && amount > 0)
			{
				countAdult = amount;
			}

			if(id == 'youth' && amount > 0)
			{
				countYouth = amount;
			}

			if(isNaN(id) && amount > 0)
			{
				countAdult = amount;
			}

			/* update ticketsAmount */
			ticketsAmount += amount;

			if(amount > 0 && amount < 15)
			{
				/* calculate total */
				price = parseFloat($('#row_' + id + ' .ticket-price').attr('data-price'));
				total = (amount * price);
				ticketsTotal = ticketsTotal + total;

				/* set total */
				$('#row_' + id + ' span.total').html(number_format(total, 2, decimalSep, '')).show();
				$('#row_' + id + ' span.euro').show();

				/* description */
				$('#navTickets').append(amount + 'x ' + $('#row_' + id + ' .ticket-description').attr('data-description') + '<br />');
			}
			else
			{
				$('#row_' + id + ' span.total').html('&nbsp;').hide();
				$('#row_' + id + ' span.euro').hide();
			}

			if(id != 'begeleider')
			{
				companionTickets += amount;
			}

			/* multimediaTour */
			var multimediaTour = $('#row_' + id).attr('data-mmt');

			if(multimediaTour != undefined)
			{
				if (multimediaTour.indexOf(';') != -1)
				{
					var multimediaTourArray = multimediaTour.split(';');

					$.each( multimediaTourArray, function( key, value )
					{
						if(multimediaTours[value])
						{
							multimediaTours[value] = multimediaTours[value] + amount;
						}
						else
						{
							multimediaTours[value] = amount;
						}

						$('#multimediaTour_' + value + ' select').html('');
					});
				}
				else
				{
					if(multimediaTours[multimediaTour])
					{
						multimediaTours[multimediaTour] = multimediaTours[multimediaTour] + amount;
					}
					else
					{
						multimediaTours[multimediaTour] = amount;
					}

					$('#multimediaTour_' + multimediaTour + ' select').html('');
				}
			}
		});

		if(companionTickets >= 0)
		{
			$('#tickets_begeleider').html('');

			for(var i = 0; i <= companionTickets; i++)
			{
				$('#tickets_begeleider').append('<option value="' + i + '"' + (companionSave == i ? ' selected="selected"' : '') + '>' + i + '</option>');
			}
		}

		if(multimediaTours['bglvip'] == undefined || multimediaTours['bglvip'] == 0)
		{
			$('#multimediaTour_bglvip').hide();
		}
		else
		{
			$('#multimediaTour_bglvip').show();
		}

		if(iAmsterdam > 0)
		{
			$('a.button .buttonText').hide().next().show();
		}
		else
		{
			$('a.button .buttonText').show().next().hide();
		}

		/* set multimediaTour */
		if(ticketsAmount > 0)
		{
			$.each(multimediaTours, function(id, amount)
			{
				for(var i = 0; i <= amount; i++)
				{
					$('#multimediaTour_' + id + ' select').append('<option value="' + i + '"' + (multimediaTourSave[id] && multimediaTourSave[id] == i ? ' selected="selected"' : '') + '>' + i + '</option>');
				}
			});
		}

		if(multimediaTours['begeleider'] == undefined || multimediaTours['begeleider'] == 0)
		{
			$('#multimediaTour_begeleider').hide();
			$('#multimediaTour_begeleider').find('select').val(0);
		}
		else
		{
			$('#multimediaTour_begeleider').show();
			$('#multimediaTour_begeleider').find('select').attr('readonly','readonly').val(multimediaTours['begeleider']);
		}

		if(language == 'ru')
		{
			if(countAdult > 0)
			{
				$('#multimediaTour_adult').find('select').val(countAdult);
			}

			if(countYouth > 0)
			{
				$('#multimediaTour_youth1317').find('select').val(countYouth);
			}

			if(countAdult > 0 || countYouth > 0)
			{
				updateMultimediaTour();
				$('#tickets-part2').show();
				$('div.ticket-button, div.ticket-button-submit').addClass('active');
			}
			else
			{
				updateMultimediaTour();
			}
		}

		/* tickets amount */
		$('#add-tickets').attr('data-ticketsamount', ticketsAmount);

		if(ticketsAmount == 0)
		{
			$('#tickets-part2').hide(effectSpeed);
			$('#add-tickets').removeClass('active');

			if(!$('#add-tickets').is(':visible'))
			{
				$('div.ticket-button, div.ticket-button-submit').removeClass('active');
			}
		}
		else if(ticketsAmount >= 15 && $('.voucher-code-container').find('span.strong').text() != 'VOV100')
		{
			$('#dialogGroup').dialog('open');
			$('#tickets-part2').hide(effectSpeed);
			$('#add-tickets').removeClass('active');

			/* reset */
			$('.tickets-selection').val('0');
			$('#tickets_begeleider').html('<option value="0">0</option>');
			$('.row-ticketType .euro').hide();
			$('.row-ticketType .total').html('&nbsp;').hide();
		}
		else
		{
			/* nav tickets
			$('#navTickets').show();
			$('#navTicketsSummary p.hidden-xs').show();
			*/

			if(!$('#add-tickets').is(':visible') && ticketsAmount > 0)
			{
				/* activate button */
				$('div.ticket-button, div.ticket-button-submit').addClass('active');
			}

			/* show add-tickets button */
			$('#add-tickets').addClass('active');
		}

		/* update tickets total */
		$('#add-tickets').attr('data-ticketstotal', ticketsTotal);

		/* update total */
		updateTotal();
	}

	if($('select.tickets-selection').length > 0)
	{
		updatePrices();
	}

	$('#add-tickets').click(function()
	{
		if($('#add-tickets').hasClass('active'))
		{
			/* show tickets part 2 */
			$('#tickets-part2').show(effectSpeed);

			/* activate button */
			$('div.ticket-button, div.ticket-button-submit').addClass('active');

			/* scroll to multimediatour */
			$.scrollTo(document.getElementById('tickets-part2'), 500);
		}

		return false;
	});

	$('body#tickets a.ticket-info__more-options').click(function()
	{
		$('.row-ticketType').show(effectSpeed);
		$(this).hide();

		return false;
	});

	$('body#datetime a.ticket-info__more-options').click(function()
	{
		$('ul.icons-payment li').show(effectSpeed);
		$(this).hide();

		return false;
	});

	/*
	* multimediatour
	*/
	$('select.multimediaTour-selection').on('change', function()
	{
		updateMultimediaTour();
	});

	$('select#people-select').on('change', function()
	{
		var ticketsAmount = $(this).val();

		if(ticketsAmount >= 15)
		{
			$('#dialogGroup').dialog('open');
		}
	});

	function updateMultimediaTour()
	{
		var id;
		var amount = 0;
		var multimediaTourAmount = 0;
		var total, price, multimediaTourTotal = 0.00;

		/* reset */
		multimediaTourSave = {};

		/* select handle */
		$('select.multimediaTour-selection').each(function(index, element)
		{
			/* id */
			id = $(this).attr('id');
			id = id.replace('select_', '');

			/* amount */
			amount = parseInt($(this).val());

			if(amount > 0)
			{
				multimediaTourAmount += amount;

				/* calculate total */
				price = parseFloat($('#' + id + ' .multimediaTour-price').attr('data-price'));

				total = (amount * price);
				multimediaTourTotal = multimediaTourTotal + total;

				/* set total */
				$('#multimediaTour_' + id + ' span.total').html(number_format(total, 2, decimalSep, '')).show();
				$('#multimediaTour_' + id + ' span.euro').show();

				/* description */
				$('#navMultimediaTour').append(amount + 'x ' + $('#multimediaTour_' + id + ' .ticket-description').attr('data-description') + '<br />');

			}
			else
			{
				$('#multimediaTour_' + id + ' span.total').html('&nbsp;').hide();
				$('#multimediaTour_' + id + ' span.euro').hide();
			}

			/* save multimediaTour */
			multimediaTourSave[id] = amount;
		});

		if(multimediaTourAmount == 0)
		{
			$('#navMultimediaTour').html('').hide();

			if($('#add-tickets[name="mmtOnlyActive"]').length > 0)
			{
				/* activate button */
				$('div.ticket-button, div.ticket-button-submit').removeClass('active');
			}
		}
		else
		{
			$('#navMultimediaTour').html(multimediaTourAmount + 'x ' + LANG_MULTIMEDIATOUR).show();

			if($('#add-tickets[name="mmtOnlyActive"]').length > 0)
			{
				/* activate button */
				$('div.ticket-button, div.ticket-button-submit').addClass('active');
			}
		}

		/* update multimediatour total */
		$('#add-tickets').attr('data-multimediatourtotal', multimediaTourTotal);

		/* update total */
		updateTotal();
	}

	/*
	* updateTotal
	*/
	function updateTotal()
	{
		/* total */
		var total = parseFloat($('#add-tickets').attr('data-ticketstotal')) + parseFloat($('#add-tickets').attr('data-multimediatourtotal'));

		/* donation */
		var donation = $('input#donation-input').val();
		donation = donation.replace('-', '');
		donation = donation.replace(',', '.');
		donation = parseFloat(donation);

		if(donation > 0)
		{
			total += donation;
		}

		/* set total */
		$('#total span.total').html(number_format(total, 2, decimalSep, '')).show();
		$('#total span.euro').show();

		if($('.donation-zone-new').length > 0 && total > 0)
		{
			$('div.ticket-button, div.ticket-button-submit').addClass('active');
		}
	}

	$('#clearVoucherButton').on('click',function()
	{
		$('#voucherForm').submit();
		return false;
	});

	/*
	* donation
	*/
	$('input#donation-input').keypress(function()
	{
		setTimeout(function(){updateTotal()}, 50);
	});

	$('.ticket-description > a').on('click',function(){
		var hiddenDesc = $(this).parents('.row-ticketType').find('.descriptionHidden');

		if($(hiddenDesc).is(':visible'))
		{
			$(hiddenDesc).hide();
		}
		else
		{
			$(hiddenDesc).show();
		}

		return false;
	});

	/*
	* MMT video
	*/
	$('#open-video').click(function()
	{
		$('#dialogMMT').dialog('open');
		return false;
	});

	/*
	* dialogs
	*/
	$('#dialogGroup').dialog({
		autoOpen: false,
		modal: true,
		width: 320,
		height: 180,
		open: function( event, ui )
		{
			$('.ui-dialog-titlebar').css('display', 'none');
		}
	});

	$('#dialogMMT').dialog({
		autoOpen: false,
		modal: true,
		width: 850,
		height: 475,
		open: function( event, ui )
		{
			$('.ui-dialog-titlebar').css('display', 'none');

			setTimeout(playVideo, 1000);
		}
	});

	$('#dialogDateMin').dialog({
		autoOpen: false,
		modal: true,
		width: 320,
		height: 180,
		open: function( event, ui )
		{
			$('.ui-dialog-titlebar').css('display', 'none');
		}
	});
	$('#dialogDateMax').dialog({
		autoOpen: false,
		modal: true,
		width: 320,
		height: 180,
		open: function( event, ui )
		{
			$('.ui-dialog-titlebar').css('display', 'none');
		}
	});
	$('#iamsterdam-card-dialog').dialog({
		autoOpen: false,
		modal: true,
		width: 400,
		height: 240,
		open: function( event, ui )
		{
			$('.ui-dialog-titlebar').css('display', 'none');
		}
	});
	$('#museumkaart-card-dialog').dialog({
		autoOpen: false,
		modal: true,
		width: 480,
		height: 300,
		open: function( event, ui )
		{
			$('.ui-dialog-titlebar').css('display', 'none');
		}
	});

	$('#stadspas-card-dialog').dialog({
		autoOpen: false,
		modal: true,
		width: 480,
		height: 300,
		open: function( event, ui )
		{
			$('.ui-dialog-titlebar').css('display', 'none');
		}
	});

	$('#iamsterdam-info').on('click', function(e)
	{
		$('#iamsterdam-card-dialog').dialog('open');

		e.preventDefault();
	});

	$('#museumkaart-info').on('click', function(e)
	{
		$('#museumkaart-card-dialog').dialog('open');

		e.preventDefault();
	});

	$('#stadspas-info').on('click', function(e)
	{
		$('#stadspas-card-dialog').dialog('open');

		e.preventDefault();
	});

	$('.close-button').click(function(e)
	{
		e.preventDefault();
		$('#dialogGroup').dialog('close');
		$('#dialogMMT').dialog('close');
		$('#dialogDateMin').dialog('close');
		$('#dialogDateMax').dialog('close');
		$('#iamsterdam-card-dialog').dialog('close');
		$('#museumkaart-card-dialog').dialog('close');
		$('#stadspas-card-dialog').dialog('close');

		//stopVideo();

		return false;
	});

	$('body').on('click', '.ui-widget-overlay', function()
	{
		$('#dialogGroup').dialog('close');
		$('#dialogMMT').dialog('close');
		$('#dialogDateMax').dialog('close');
		$('#dialogDateMin').dialog('close');
		$('#iamsterdam-card-dialog').dialog('close');
		$('#museumkaart-card-dialog').dialog('close');
		$('#stadspas-card-dialog').dialog('close');

		//stopVideo();

		return false;
	});

	/*
	* yourinformation
	*/
	function termsandconditionsCheck()
	{
		if (!$('#termsandconditions').length) {
			return;
		}

		var checked = $('#termsandconditions').is(':checked'),
			buttons = $('div.ticket-button, div.ticket-button-submit');

		checked ? buttons.addClass('active') : buttons.removeClass('active');
	}
	termsandconditionsCheck();

	$('#termsandconditions').on('change', function(e)
	{
		termsandconditionsCheck();
	});

	/*
	* check
	*/
	$('.paymentmethods[id!="component-container"] input[name="paymentradio"]').change(function()
	{
		/* activate button */
		$('div.ticket-button, div.ticket-button-submit').addClass('active');

		/* submit */
		$('form#gt').submit();

		return false;
	});

	$('body#check a.ticket-info__more-options').click(function()
	{
		$('div.paymentmethods div').show(effectSpeed);
		$(this).hide();

		return false;
	});

	$('#cookie-container .buttons-wrap a').on('click',function(e)
	{
		e.preventDefault();

		var cookieVal = 0;

		if($(this).attr('id') == 'cookiesAccept')
		{
			cookieVal = 1;
		}

		var d = new Date();
		d.setTime(d.getTime() + (10 * 365 * 24 * 60 * 60 * 1000));
		var cookieDomain = (window.location.hostname ? window.location.hostname : '.vangoghmuseum.com');
		cookieDomain = cookieDomain.replace('tickets', '');

		document.cookie = '.GdprCookie.V1' + '=' + cookieVal + ';expires=' + d.toUTCString() + ';domain=' + cookieDomain + ';path=/;secure';

		$('#cookie-container').hide('fast');
	});

	/* changes */
	function videoScroll(){
		var videoPos = $('a.open-video').offset(),
			videoHeight = $('a.open-video').outerHeight() / 2;

		$(window).on('scroll', function(){
			if($('#tickets-part2').is(':visible')){
				var windowHeight = $(window).height() / 2,
					windowTop = $(window).scrollTop(),
					windowPos = windowHeight + windowTop;

				if(videoPos.top + videoHeight > windowPos){
					$('a.open-video').css({
						'position': 'static'
					});
				}
				if(windowPos > videoPos.top + videoHeight){
					$('a.open-video').css({
						'position': 'fixed',
						'top': windowHeight - videoHeight,
						'left': videoPos.left
					});
				}
				if($('a.open-video').offset().top > $('#tickets-part2').offset().top){
					var offset = $('a.open-video').offset().top;

					$('a.open-video').css({
						'position': 'absolute',
						'top': $('.ticket-blue').offset().top,
						'left': videoPos.left
					});
				}
			} else{
				$('a.open-video').css({
					'position': 'static',
					'top': 'auto',
					'left': 'auto'
				});
			}
		});
	}

	function stepsHover(){
		$('.nav-steps .steps').hover(function()
		{
			if($('#navDateTime').has('p.sub.hidden-xs').length)
			{
				$('.sub.hidden-xs').stop(true).slideDown('fast');
			}
		}, function()
		{
			if($('#navDateTime').has('p.sub.hidden-xs').length)
			{
				$('.sub.hidden-xs').stop(true).slideUp('fast');
			}
		});
	}

	function steps(){
		displayMobileFooter();

		$(window).on('scroll', function(){
			displayMobileFooter();
		});
	}

	function displayMobileFooter()
	{
		if ($('.ticket-button').hasClass('mobile')){
			var scrollTop = $(window).scrollTop(),
				headerPos = $('header').offset().top + $('header').height();

			if(scrollTop > headerPos || $(document).height()-headerPos <= $(window).height())
			{
				$('.ticket-button.mobile').slideDown('fast');
			}
		}
	}

	function mobile_leesmeer_button(){
		$('#mobile_leesmeer_button').on('click', function(e){
			e.preventDefault();

			var leesmeer = $('#mobile_leesmeer_button').offset().top;

			$('#mobile_leesmeer').show();

			if(!$(this).hasClass('active')){
				$(this).hide();

				$(window).animate({
					scrollTop: (leesmeer - 50)
				}, 'slow');
			} else{
				$(this).addClass('active');
			}
		});
	}

	function copypaste(){
		$(document).on('paste', "#emailAddressConfirm", function(e){
			e.preventDefault();
		});
	}
	copypaste();



	function ticketDate(){
		var $ticketDate = $('#ticketDate'),
			maxDate = $ticketDate.attr('max'),
			minDate = $ticketDate.attr('min'),
			maanden = ["januari", "februari", "maart", "april", "mei", "juni", "july", "augustus", "september", "oktober", "november", "december"],
			months = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ],
			a = new Date(minDate),
			b = new Date(maxDate),
			minDate_text = a.getDate() + ' ' + maanden[a.getMonth()] + ' ' + a.getFullYear(),
			maxDate_text = b.getDate() + ' ' + maanden[b.getMonth()] + ' ' + b.getFullYear(),
			message = 'Tickets zijn alleen verkrijgbaar van ' + minDate_text + ' tot en met ' + maxDate_text;

		function ticketDate_message(){
			// Als het gekozen datum NIET binnen het aangegeven datum valt, dan komt er een waarschuwing.
			// Als het gekozen datum WEL binnen het aangegeven datum valt, dan kom de timetable.
			if($($ticketDate).val() < minDate || $($ticketDate).val() > maxDate){
				if($($ticketDate).val() < minDate){
					$($ticketDate).val(minDate);
					$('#dialogDateMin').dialog('open');
				}
				else if($($ticketDate).val() > maxDate){
					$($ticketDate).val(maxDate);
					$('#dialogDateMax').dialog('open');
				}

			} else{
				loadTimeslots($('#ticketDate').val());
			}
		}

		var ticketDate_msg = {
			ios : function(){
				$ticketDate.on('blur', function(){ //Focus veranderd
					ticketDate_message();
				});
			},
			android : function(){
				$ticketDate.on('change', function(){ //Value veranderd
					ticketDate_message();
				});
			}
		};

		var userAgent = navigator.userAgent || navigator.vendor || window.opera;
		if( userAgent.match( /iPad/i ) || userAgent.match( /iPhone/i ) || userAgent.match( /iPod/i ) ) {
			ticketDate_msg.ios();
		} else if( userAgent.match( /Android/i ) ) {
			ticketDate_msg.android();
		} else {
			ticketDate_msg.android();
		}
	}


	function browser(){
		if (768 > $(window).width()){
			steps();
			mobile_leesmeer_button();
			ticketDate();

/*
			if($('#ticketDate').length > 0 && $('.table-time').find('a').length == 0)
			{
				firstLoad = true;
				loadTimeslots($('#ticketDate').val());
			}
*/
		} else {
			$('.ticket-button').removeClass('mobile').slideDown('fast'); //function steps()
			stepsHover();
			// videoScroll();
		}
	}
	$(window).on('resize', browser);
	$(document).ready(browser);

	/***************************************
	Dialogs
	***************************************/
	$('.dialog-container').dialog(
	{
		autoOpen: false,
		modal: true,
		resizable: false,
		draggable: false,
		width: '100%',
		open: function()
		{
			$('body').css('overflow', 'hidden');
		},
		close: function()
		{
			$('body').css('overflow', 'visible');
		}
	});

	$('[data-dialog]').on('click', function(e)
	{
		var dialog = $(this).data('dialog');

		$(dialog).dialog('open');

		e.preventDefault();
	});

	$('.close-dialog').on('click', function(e)
	{
		$('.dialog-container').dialog('close');

		e.preventDefault();
	});

	/***************************************
	Donation
	***************************************/
	var donationColumnLeft = $('.donatie .col-xs-8').addClass('donationOther');
	var donationColumnRight = $('.donatie .col-xs-4').addClass('donationOther');
	$(donationColumnRight).removeClass('col-xs-4').addClass('col-xs-12 text--right');

	$(donationColumnLeft).remove();

	$('.vgm-donation').click(function(e)
	{
		if($(this).hasClass('vgmActive'))
		{
			$(this).removeClass('vgmActive');
			$('.donatie .donationOther').hide();
			$('input#donation-input').val('0.00');
			updateTotal();
		}
		else
		{
			$('.vgm-donation').removeClass('vgmActive');
			var donationValue = $(this).data('donationvalue');
			$(this).addClass('vgmActive');
			if( donationValue == 'other' )
			{
				// $('input#donation-input').val('0.00').trigger(jQuery.Event('keypress', {keycode: 13}));
				$('.donatie .donationOther').show();
			}
			else
			{
				$('input#donation-input').val(donationValue);
				updateTotal();
				$('.donatie .donationOther').hide();
			}
		}

		e.preventDefault();
	});

	// select button on pageLoad
	/*
	var currentDonation = $('input#donation-input').val();

	if( currentDonation != '0.00' && currentDonation != '0,00' )
	{
		var currentDonationButton = $('.vgm-donation[data-donationvalue="' + currentDonation + '"]');
		var currentDonationButtonLenght = $(currentDonationButton).length;
		if( currentDonationButtonLenght >= 1 )
		{
			$(currentDonationButton).addClass('vgmActive');
		}
		else
		{
			$('.vgm-donation[data-donationvalue="other"]').addClass('vgmActive');
			$('.donatie .donationOther').show();
		}
	}
	*/

/***************************************
	add to & remove from cart
***************************************/
	function addToCart(product) {
		dataLayer.push({
			event: 'addToCart',
			ecommerce: {
				currencyCode: 'EUR',
				add: {
					products: [product]
				}
			}
		});
	}

	function removeFromCart(product) {
		dataLayer.push({
			event: 'removeFromCart',
			ecommerce: {
				currencyCode: 'EUR',
				add: {
					products: [product]
				}
			}
		});
	}

	var gtmCart = [];

	function getProduct(element) {
		var name = element.find('[data-description]').data('description'),
			id = element.find('.tickets-selection').attr('name'),
			price = element.find('[data-price]').data('price'),
			brand = 'onlinetickets',
			category = 'Regular Flow',
			variant = language.toUpperCase() + ' - onlinetickets',
			quantity = parseInt(element.find('.tickets-selection').val());

		id = id.substring(
			id.lastIndexOf('[') + 1,
			id.lastIndexOf(']')
		);

		var product = {
				name: name,
				id: id,
				price: price,
				brand: brand,
				category: category,
				variant: variant,
				quantity: quantity
			};

		return product;
	}

	$('.tickets-selection').each(function() {
		var product = getProduct($(this).closest('.row-ticketType'));

		gtmCart.push(product);
	});

	$('.tickets-selection').on('change', function() {
		var row = $(this).closest('.row-ticketType'),
			thisProduct = getProduct(row);

		gtmCart.forEach(function(product, index) {
			var id = product.id,
				quantity = product.quantity;

			if (id === thisProduct.id) {
				if (thisProduct.quantity > quantity) {
					var number = thisProduct.quantity - quantity;

					// update cart
					gtmCart[index]['quantity'] = thisProduct.quantity;

					// update quantity to send to gtm
					thisProduct.quantity = number;

					addToCart(thisProduct);
				} else if (thisProduct.quantity < quantity) {
					var number = quantity - thisProduct.quantity;

					// update cart
					gtmCart[index]['quantity'] = thisProduct.quantity;

					// update quantity to send to gtm
					thisProduct.quantity = number;

					removeFromCart(thisProduct);
				}
			}
		});
	});

});
